<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Star Wars Characters - GeorgiaJedi</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.18.3/bootstrap-table.min.css">
  <link rel="stylesheet" href="css/styles.css">
  <style>
    #toolbar { margin: 10px 0; }
    #loading { font-size: 1.25rem; font-weight: 500; }
  </style>
</head>
<body>
<header class="d-flex align-items-center justify-content-center py-4">
  <img src="images/GeorgiaJedi-logo-256.jpg" alt="GeorgiaJedi Logo" class="logo mr-3">
  <h1 class="mx-auto">Star Wars Character Catalog</h1>
</header>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="#">GeorgiaJedi</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav">
      <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
      <li class="nav-item"><a class="nav-link" href="autographs.html">Autographs</a></li>
      <li class="nav-item"><a class="nav-link" href="collectibles.html">Collectibles</a></li>
      <li class="nav-item active"><a class="nav-link" href="cast.html">Characters</a></li>
      <li class="nav-item"><a class="nav-link" href="add-item.html">Add Item</a></li>
    </ul>
  </div>
</nav>

<main class="container my-5">
  <div id="loading" class="text-center my-5">Loading characters...</div>

  <div id="toolbar" class="select" style="display: none;">
    <label for="professionFilter">Filter by Profession:</label>
    <select id="professionFilter" class="form-control w-auto d-inline-block ml-2">
      <option value="">Show All</option>
    </select>
  </div>

  <table id="characterTable"
         class="table table-bordered"
         style="display: none;"
         data-toggle="table"
         data-pagination="true"
         data-pagination-v-align="both"
         data-click-to-select="true"
         data-toolbar="#toolbar"
         data-page-size="10"
         data-show-footer="false"
         data-export-types="['json', 'xml', 'csv', 'txt', 'sql', 'excel', 'pdf']">
    <thead>
      <tr>
        <th data-field="state" checkbox></th>
        <th data-field="id" data-sortable="true">ID</th>
        <th data-field="name" data-sortable="true">Name</th>
        <th data-field="professions" data-sortable="true">Professions</th>
        <th data-field="known_for" data-sortable="true">Known For</th>
        <th data-field="bio" data-sortable="true">Biography</th>
      </tr>
    </thead>
  </table>
</main>

<footer class="text-center py-4">
  <p>&copy; 2024 GeorgiaJedi. All rights reserved.</p>
</footer>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.18.3/bootstrap-table.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.18.3/extensions/export/bootstrap-table-export.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tableexport.jquery.plugin@1.29.0/tableExport.min.js"></script>

<script>
  const $table = $('#characterTable');
  const $loading = $('#loading');
  const $toolbar = $('#toolbar');
  const $professionFilter = $('#professionFilter');
  let allData = [];

  const worker = new Worker('js/castWorker.js');
  worker.postMessage('load');

  worker.onmessage = function (e) {
    if (e.data && Array.isArray(e.data)) {
      allData = e.data;

      const professionCounts = {};
      allData.forEach(row => {
        row.professions.split(',').map(p => p.trim()).forEach(p => {
          professionCounts[p] = (professionCounts[p] || 0) + 1;
        });
      });

      Object.entries(professionCounts)
        .sort((a, b) => a[0].localeCompare(b[0]))
        .forEach(([prof, count]) => {
          $professionFilter.append(`<option value="${prof}">${prof} (${count})</option>`);
        });

      $loading.hide();
      $toolbar.show();
      $table.show();
      $table.bootstrapTable({
        data: allData,
        pagination: true,
        pageSize: 10,
        clickToSelect: true,
        showExport: true,
        exportDataType: 'basic',
        exportTypes: ['json', 'xml', 'csv', 'txt', 'sql', 'excel', 'pdf']
      });
      $table.bootstrapTable('load', allData);
    } else {
      $loading.text('Failed to load characters.');
      console.error('Worker returned no data.');
    }
  };

  $professionFilter.on('change', function () {
    const selected = $(this).val();
    const profession = selected.replace(/ \\(\\d+\\)$/, '');
    const filtered = profession
      ? allData.filter(row => row.professions.split(',').map(p => p.trim()).includes(profession))
      : allData;

    $table.bootstrapTable('load', filtered);
  });
</script>
</body>
</html>
