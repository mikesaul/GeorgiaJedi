<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Star Wars Memorabilia Gallery</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <header class="text-center py-4">
        <h1>Welcome to the Star Wars Memorabilia Gallery</h1>
    </header>

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">GeorgiaJedi</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="autographs.html">Autographs</a></li>
                <li class="nav-item"><a class="nav-link" href="collectibles.html">Collectibles</a></li>
                <li class="nav-item"><a class="nav-link" href="add-item.html">Add Item</a></li>
            </ul>
        </div>
    </nav>

    <main class="container text-center my-5">
        <div id="imageCarouselContainer"></div> 
        <a class="backnav" href="#" id="backnav">Back to Catalog</a>
    </main>

    <footer class="text-center py-4">
        <p>&copy; 2024 GeorgiaJedi. All rights reserved.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            var imageName = urlParams.get("image");
            var page = urlParams.get("pg");
            const sender = urlParams.get("sender");  // Get the sender (autographs or collectibles)
            var div = document.getElementById('imageCarouselContainer');
    
            // Debugging: Log the image name and query parameters to ensure they are correct
            console.log("Image Name:", imageName);
            console.log("Page:", page);
            console.log("Sender:", sender);
    
            if (page && sender) {
                const backnav = document.getElementById('backnav');
                if (backnav) {
                    backnav.href = sender + ".html?pg=" + page; // Append page number to the link
                } else {
                    console.error("Backnav element not found.");
                }
            }
    
            // Function to load images from the server
            function loadImages() {
                if (!imageName) {
                    div.innerHTML = '<p>Error: Image not specified.</p>';
                    return;
                }
                
                fetch('list-images.asp')
                .then(response => response.json())
                .then(images => {
                    // Debugging: Log the list of images received from the server
                    console.log("Images fetched from server:", images);
    
                    // Filter the images to find those that start with the base image name
                    var matchingImages = images.filter(function(image) {
                        return image.includes(imageName);  // Match based on base name
                    });
    
                    // Debugging: Log the matching images to check if any are found
                    console.log("Matching Images:", matchingImages);
    
                    if (matchingImages.length > 0) {
                        // Sort images so that the base version comes first
                        matchingImages.sort((a, b) => {
                            if (!a.includes('-')) return -1;
                            if (!b.includes('-')) return 1;
                            return 0;
                        });
    
                        // Create the carousel container
                        var carouselDiv = document.createElement('div');
                        carouselDiv.id = 'imageCarousel';
                        carouselDiv.className = 'carousel slide';
                        carouselDiv.setAttribute('data-ride', 'carousel');
    
                        // Carousel inner div
                        var carouselInner = document.createElement('div');
                        carouselInner.className = 'carousel-inner';
    
                        // Loop through the sorted images and create carousel items
                        matchingImages.forEach((image, index) => {
                            var carouselItem = document.createElement('div');
                            carouselItem.className = 'carousel-item';
                            if (index === 0) {
                                carouselItem.classList.add('active');
                            }
    
                            var imgElement = document.createElement('img');
                            imgElement.src = image;
                            imgElement.className = 'd-block w-100';
                            imgElement.alt = 'Image ' + (index + 1);
    
                            carouselItem.appendChild(imgElement);
                            carouselInner.appendChild(carouselItem);
                        });
    
                        // Add carousel controls
                        var prevControl = `
                            <a class="carousel-control-prev" href="#imageCarousel" role="button" data-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="sr-only">Previous</span>
                            </a>
                        `;
                        var nextControl = `
                            <a class="carousel-control-next" href="#imageCarousel" role="button" data-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="sr-only">Next</span>
                            </a>
                        `;
    
                        // Append carousel inner and controls to the main carousel div
                        carouselDiv.appendChild(carouselInner);
                        carouselDiv.innerHTML += prevControl + nextControl;
    
                        // Append carousel to the div
                        div.appendChild(carouselDiv);
                    } else {
                        div.innerHTML = '<p>No matching images found.</p>';
                    }
                })
                .catch(error => {
                    console.error('Error loading images:', error);
                    div.innerHTML = '<p>Error loading images.</p>';
                });
            }
    
            // Call the function to load images
            loadImages();
        });
    </script>
            
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
