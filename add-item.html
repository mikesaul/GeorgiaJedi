<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Item - Star Wars Memorabilia Gallery</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="js/updateJSON.js"></script>
    <script src="js/script.js"></script>
    <link rel="stylesheet" href="css/styles.css">

    <script>
/*      // Case-insensitive alphanumeric sort with numeric prefix handling
     function alphanumericCaseInsensitiveSort(a, b) {
        const regex = /^(\d+)(.*)/i;
        const matchA = a.match(regex);
        const matchB = b.match(regex);

        if (matchA && matchB) {
            const numA = parseInt(matchA[1], 10);
            const numB = parseInt(matchB[1], 10);
            if (numA !== numB) return numA - numB;
            return matchA[2].toLowerCase().localeCompare(matchB[2].toLowerCase());
        }

        return a.toLowerCase().localeCompare(b.toLowerCase());
    }

 */
       $(document).ready(function() {
            // Initialize the datepicker for the acquired field
            $("#acquired").datepicker({ dateFormat: "mm/dd/yy" });

            // Disable all form fields except the Item Type dropdown initially
            $('#dataForm :input').not('#itemType').prop('disabled', true);

            // Enable form fields and load franchise data when Item Type is selected
            $('#itemType').on('change', function() {
                const itemType = $(this).val();
                
                if (itemType) {
                    // Enable all form fields when Item Type is selected
                    $('#dataForm :input').prop('disabled', false);

                    const jsonFileName = `data/${itemType}.json`;
                    $.getJSON(jsonFileName, function(data) {
                        // Generate unique, sorted franchise list
                        const franchises = [...new Set(data.map(item => item.franchise).filter(Boolean))];
                        franchises.sort(alphanumericCaseInsensitiveSort);

                        // Populate the franchise datalist
                        const franchiseDatalist = $('#franchiseList');
                        franchiseDatalist.empty();
                        franchises.forEach(franchise => {
                            franchiseDatalist.append(new Option(franchise));
                        });

                        
                    // --- Source handling ---
                    const sourceOptions = [...new Set(data.map(item => item.source).filter(Boolean))];
                    sourceOptions.sort(alphanumericCaseInsensitiveSort);
                    const sourceDatalist = $('#sourceList');
                    sourceDatalist.empty();
                    sourceOptions.forEach(option => {
                        sourceDatalist.append(new Option(option));
                    });

                    // --- Size handling ---
                    const sizeOptions = [...new Set(data.map(item => item["size/model#"]).filter(Boolean))];
                    sizeOptions.sort(alphanumericCaseInsensitiveSort);
                    const sizeDatalist = $('#sizeList');
                    sizeDatalist.empty();
                    sizeOptions.forEach(option => {
                        sizeDatalist.append(new Option(option));
                    });

                // Generate unique, sorted is_verified list
                const isVerifiedOptions = [...new Set(data.map(item => item.is_verified).filter(Boolean))];
                isVerifiedOptions.sort();

                // Populate the is_verified datalist
                const isVerifiedDatalist = $('#isVerifiedList');
                isVerifiedDatalist.empty();
                isVerifiedOptions.forEach(option => {
                    isVerifiedDatalist.append(new Option(option));
                });
                    }).fail(function() {
                        alert('Failed to load franchise data.');
                    });
                } else {
                    // Reset the form and disable all fields if no Item Type is selected
                    $('#dataForm')[0].reset();
                    $('#dataForm :input').not('#itemType').prop('disabled', true);
                    $('#franchiseList').empty();
                }
            });
        });
    </script>
</head>
<body>
    <header class="d-flex align-items-center justify-content-center py-4">
        <img src="images/GeorgiaJedi-logo-256.jpg" alt="GeorgiaJedi Logo" class="logo mr-3">
        <h1 class="mx-auto">Star Wars Autograph Catalog</h1>
    </header>

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">GeorgiaJedi</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="autographs.html">Autographs</a></li>
                <li class="nav-item"><a class="nav-link" href="collectibles.html">Collectibles</a></li>
                <li class="nav-item"><a class="nav-link" href="cast.html">Cast/Crew/Characters</a></li>
                <li class="nav-item active"><a class="nav-link" href="add-item.html">Add Item</a></li>
                <li class="nav-item"><a class="nav-link" href="fileuploadtest.html">Thumb Generator</a></li>
            </ul>
        </div>
    </nav>

    <main class="container my-5">
        <h2 class="mb-4 text-center">Add Memorabilia</h2>
        <form id="dataForm" class="bg-light p-4 rounded shadow row" autocomplete="off">
            <div class="form-group col-md-3">
                <label for="itemType">Select Item Type:</label>
                <select id="itemType" name="itemType" class="form-control" required>
                    <option value="">-- Select Type --</option>
                    <option value="autographs">Autographs</option>
                    <option value="collectibles">Collectibles</option>
                </select>
            </div>
            <div class="form-group col-md-9">
                &nbsp;
            </div>
        
        
            <div class="form-group col-md-3">
                <label for="id">ID:</label>
                <input type="text" id="id" name="id" class="form-control" readonly required>
            </div>

            <div class="form-group col-md-3">
                <label for="title">Name/Title:</label>
                <input type="text" id="title" name="title" class="form-control" required>
            </div>

            <div class="form-group col-md-3">
                <label for="franchise">Franchise:</label>
                <input list="franchiseList" id="franchise" name="franchise" class="form-control" required>
                <datalist id="franchiseList"></datalist>
            </div>
        
            <div class="form-group col-md-3">
                <label for="acquired">Acquired Date:</label>
                <input type="text" id="acquired" name="acquired" class="form-control" placeholder="mm/dd/yyyy">
            </div>

            <div class="form-group col-md-12">
                <label for="description">Description:</label>
                <textarea id="description" name="description" class="form-control"></textarea>
            </div>

            <div class="form-group col-md-3">
                <label for="size">Size:</label>
                <!-- <input type="text" id="size" name="size" class="form-control"> -->
                <input type="text" id="size" name="size" list="sizeList" class="form-control">
                <datalist id="sizeList"></datalist>            </div>

            <div class="form-group col-md-3">
                <label for="source">Source:</label>
                <input type="text" id="source" name="source" list="sourceList" class="form-control">
                <!-- <input type="text" id="source" name="source" class="form-control"> -->
                <datalist id="sourceList"></datalist>
            </div>

            <!-- Dropdown for Personalized field -->
            <div class="form-group col-md-3">
                <label for="personalized">Personalized:</label>
                <select id="personalized" name="personalized" class="form-control">
                    <option value="">-- Select --</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                    <option value="N/A">N/A</option>
                    <option value="Unknown">Unknown</option>
                </select>
            </div>
            </div>

            <!-- Combo box for Is Verified field -->
            <div class="form-group col-md-3">
                <label for="is_verified">Is Verified:</label>
                <input list="isVerifiedList" id="is_verified" name="is_verified" class="form-control">
                <datalist id="isVerifiedList"></datalist>
            </div>

            <div class="form-group col-md-3">
                <label for="serialnumber">Serial Number:</label>
                <input type="text" id="serialnumber" name="serialnumber" class="form-control">
            </div>

            <div class="form-group col-md-3">
                <label for="original_cost">Original Cost:</label>
                <input type="text" id="original_cost" name="original_cost" class="form-control">
            </div>

            <div class="form-group col-md-3">
                <label for="current_value">Current Value:</label>
                <input type="text" id="current_value" name="current_value" class="form-control">
            </div>

            <div class="form-group col-md-3">
                <label for="image">Image:</label>
                <input type="text" id="image" name="image" class="form-control">
            </div>

            <div class="form-group col-md-12">
                <button type="submit" class="btn btn-primary btn-block">Update Item</button>
            </div>
        </form>
    </main>

    <footer class="text-center py-4">
        <p>&copy; 2024 GeorgiaJedi. All rights reserved.</p>
    </footer>
</body>
</html>
