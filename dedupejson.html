<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Remove Duplicates - Star Wars Memorabilia Gallery</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" />
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
    <header class="d-flex align-items-center justify-content-center py-4">
        <img src="images/GeorgiaJedi-logo-256.jpg" alt="GeorgiaJedi Logo" class="logo mr-3">
        <h1 class="mx-auto">Star Wars Autograph Catalog</h1>
    </header>

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">GeorgiaJedi</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="autographs.html">Autographs</a></li>
                <li class="nav-item"><a class="nav-link" href="collectibles.html">Collectibles</a></li>
                <li class="nav-item"><a class="nav-link" href="cast.html">Cast/Crew/Characters</a></li>
                <li class="nav-item active"><a class="nav-link" href="remove-duplicates.html">Remove Duplicates</a></li>
            </ul>
        </div>
    </nav>

    <main class="container my-5">
        <h2 class="mb-4 text-center">Remove Duplicate Records</h2>
        <form class="bg-light p-4 rounded shadow" onsubmit="return false;">
            <div class="form-group">
                <label for="uploadJson">Choose JSON File:</label>
                <input type="file" id="uploadJson" class="form-control" accept=".json" />
            </div>
            <div class="form-group">
                <button class="btn btn-primary btn-block" onclick="processJson()">Clean & Download</button>
            </div>
            <p class="text-muted small">
                This tool removes duplicate entries based on <strong>name</strong> (case-insensitive), keeping the first occurrence.
            </p>
        </form>
    </main>

    <footer class="text-center py-4">
        <p>&copy; 2024 GeorgiaJedi. All rights reserved.</p>
    </footer>

    <script>
        function removeDuplicatesByName(data) {
            const seen = new Set();
            return data.filter(item => {
                const nameKey = (item.name || '').trim().toLowerCase();
                if (seen.has(nameKey)) return false;
                seen.add(nameKey);
                return true;
            });
        }

        function compactArrayFormatting(jsonString) {
            return jsonString.replace(
                /\[\s+("[^"]+"(?:,\s*"[^"]+")*)\s+\]/g,
                (_, arrayContent) => `[ ${arrayContent.replace(/\s+/g, ' ')} ]`
            );
        }

        function processJson() {
            const input = document.getElementById('uploadJson');
            const file = input.files[0];
            if (!file) {
                alert('Please select a JSON file.');
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (!Array.isArray(data)) {
                        alert("The JSON file must contain an array of objects.");
                        return;
                    }

                    const cleaned = removeDuplicatesByName(data);

                    let jsonString = JSON.stringify(cleaned, null, 2);
                    jsonString = compactArrayFormatting(jsonString);

                    const blob = new Blob([jsonString], { type: "application/json" });
                    const url = URL.createObjectURL(blob);

                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'catalog-cleaned.json';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                } catch (err) {
                    alert("Invalid JSON file: " + err.message);
                }
            };

            reader.readAsText(file);
        }
    </script>
</body>
</html>
